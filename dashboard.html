<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BlueJobs — Dashboard</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <style>
    .drawer-bg { background: rgba(0,0,0,0.35); }
    .tab-active { background-color:#eef2ff; color:#4338ca; font-weight:600; }
    .job-card:hover { border-color:#4338ca; box-shadow:0 0 0 2px #4338ca33; }
  </style>
</head>
<body class="bg-gray-50 font-sans text-gray-800 h-screen">
<!-- Mobile Topbar -->
<header class="bg-white shadow-sm flex items-center justify-between p-4 md:hidden">
  <div class="flex items-center gap-2">
    <img src="bluejobs-logo.jpg" alt="BlueJobs" class="h-8">
    <span class="font-bold text-indigo-600">BlueJobs</span>
  </div>
  <button id="mobileMenuBtn" class="p-2 text-gray-600 hover:text-indigo-600">
    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>
</header>
<!-- Mobile Drop Menu -->
<nav id="mobileMenu"
     class="hidden md:hidden bg-white border-b shadow-sm flex flex-col px-4 py-3 space-y-2">
  <a data-tab="dashboard" class="nav-btn dashboard py-2 text-gray-700 hover:text-indigo-600">Job Board</a>
  <a data-tab="myjobs" class="hidden nav-btn btnMyJobs py-2 text-gray-700 hover:text-indigo-600">My Jobs</a>
  <a data-tab="myapplications" class="hidden nav-btn btnMyApplications py-2 text-gray-700 hover:text-indigo-600">My Applications</a>
  <a data-tab="post-job" class="nav-btn post-job py-2 text-gray-700 hover:text-indigo-600">Post a Job</a>
  <a data-tab="applications" class="nav-btn applications py-2 text-gray-700 hover:text-indigo-600">Applications</a>
  <a data-tab="profile" class="nav-btn py-2 text-gray-700 hover:text-indigo-600">Profile</a>
  <a data-tab="verification" class="nav-btn py-2 text-gray-700 hover:text-indigo-600">Verification</a>
  <a data-tab="notifications" class="nav-btn py-2 text-gray-700 hover:text-indigo-600">Notifications</a>
  <a id="mobileSignBtn" href="signin.html"
     class="hidden block py-2 text-white bg-indigo-600 rounded text-center">Sign In</a>
</nav>
<!-- WRAPPER -->
<div class="flex h-screen">
  <!-- ========== SIDEBAR ========== -->
  <aside id="mobileSidebar" class="hidden md:flex flex-col w-64 bg-white border-r shadow-sm p-4 space-y-6">
    <div>
      <!-- logo -->
      <div class="flex items-center gap-3 px-6 py-5">
        <img src="bluejobs-logo.jpg" alt="BlueJobs" class="w-20">
      </div>
      <!-- nav -->
      <nav id="sidebarNav" class="mt-4 space-y-1">
        <button data-tab="dashboard" class="nav-btn dashboard w-full flex items-center gap-3 px-6 py-3 text-left hover:bg-gray-100">
          <i class="fa-solid fa-briefcase"></i> Job Board
        </button>
        <button data-tab="myjobs" class="hidden nav-btn btnMyJobs w-full flex items-center gap-3 px-6 py-3 text-left hover:bg-gray-100">
          <i class="fa-solid fa-briefcase"></i> My Jobs
        </button>
        <button data-tab="myapplications" class="hidden nav-btn btnMyApplications w-full flex items-center gap-3 px-6 py-3 text-left hover:bg-gray-100">
          <i class="fa-solid fa-file-lines"></i> My Applications
        </button>
        <button data-tab="post-job" class="nav-btn post-job w-full flex items-center gap-3 px-6 py-3 text-left hover:bg-gray-100">
          <i class="fa-solid fa-square-plus"></i> Post a Job
        </button>
        <button data-tab="applications" class="nav-btn applications w-full flex items-center gap-3 px-6 py-3 text-left hover:bg-gray-100">
          <i class="fa-solid fa-file-lines"></i> Applications
        </button>
        <button data-tab="profile" class="nav-btn w-full flex items-center gap-3 px-6 py-3 text-left hover:bg-gray-100">
          <i class="fa-solid fa-user"></i> Profile
        </button>
        <button data-tab="verification" class="nav-btn w-full flex items-center gap-3 px-6 py-3 text-left hover:bg-gray-100">
          <i class="fa-solid fa-shield"></i> Verification
        </button>
        <button data-tab="notifications" class="nav-btn w-full flex items-center gap-3 px-6 py-3 text-left hover:bg-gray-100">
          <i class="fa-solid fa-bell"></i> Notifications
        </button>
      </nav>
    </div>

    <div class="m-6 text-xs text-gray-500 text-center fixed bottom-2">© BlueJobs 2025</div>
  </aside>

  <!-- ========== MAIN ========== -->
  <main class="flex-1 overflow-auto min-h-screen">
    <!-- topbar -->
    <header class="hidden md:flex bg-white border-b flex items-center justify-between px-4 py-2 sticky top-0 z-20">
      <div class="font-bold">BlueJobs Dashboard</div>
      <div class="flex items-center gap-4">
        <div class="relative">
          <i class="fa-solid fa-bell text-gray-600"></i>
          <span id="notifBadge" class="absolute -top-2 -right-3 bg-red-500 text-white rounded-full px-1 text-xs hidden">0</span>
        </div>
        <button id="signInBtn" class="px-3 py-1 bg-indigo-600 text-white rounded text-sm">Sign In</button>
      </div>
    </header>

    <!-- CONTENT -->
    <div class="max-w-6xl mx-auto p-6">

      <!-- JOB BOARD -->
      <section id="view-dashboard" class="tab-view hidden">
        <!-- Job Board header with search -->
        <div class="mb-6">
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <h2 class="text-xl font-semibold">Job Board</h2>
            <!-- search bar -->
            <div class="flex items-center bg-white border rounded-full px-4 py-2 shadow-sm w-full md:w-1/2">
              <i class="fa-solid fa-magnifying-glass text-gray-400 mr-2"></i>
              <input id="searchTitle" type="text" placeholder="Job title or keywords"
                    class="w-32 md:w-32 outline-none flex-1 text-sm text-gray-700" />
              <div class="ml-1 md:block h-6 w-px bg-gray-200 mx-2"></div>
              <i class="fa-solid fa-location-dot text-gray-400 mr-2"></i>
              <input id="searchLocation" type="text" placeholder="Anywhere"
                    class="w-28 md:w-25 outline-none text-sm text-gray-700" />
            </div>
          </div>
          <!-- optional small filter row (tags/buttons) -->
          <div class="mt-4 flex flex-wrap gap-2 text-sm">
            <button class="px-3 py-1 bg-gray-100 rounded-full hover:bg-indigo-50" data-filter="Remote">Remote</button>
            <button class="px-3 py-1 bg-gray-100 rounded-full hover:bg-indigo-50" data-filter="Full-time">Full-time</button>
            <button class="px-3 py-1 bg-gray-100 rounded-full hover:bg-indigo-50" data-filter="Part-time">Part-time</button>
            <button id="clearFilters" class="px-3 py-1 bg-gray-100 rounded-full hover:bg-gray-200">Clear</button>
          </div>
          <!-- Job count -->
          <div id="jobCount" class="mt-2 text-sm text-gray-500">
            We have found <span class="font-medium">0</span> jobs
          </div>
        </div>
        <div id="jobsList" class="space-y-4"></div>
      </section>

      <!-- POST JOB -->
      <section id="view-post-job" class="tab-view hidden">
        <h2 class="text-xl font-semibold mb-4">Post a Job</h2>
        <form id="postJobForm" class="bg-white p-6 rounded shadow space-y-4 w-full">
          <!-- Job title -->
          <div>
            <label class="block text-sm font-medium mb-1">Job Title (Kazi gani)</label>
            <input name="title" placeholder="e.g. Cleaner, Cook…" 
                   class="border px-3 py-2 w-full rounded" required>
          </div>
        
          <!-- Salary + period -->
          <div>
            <label class="block text-sm font-medium mb-1">Salary</label>
            <div class="flex flex-col md:flex-row gap-2">
              <input name="salaryAmount" type="number" min="0" placeholder="Amount"
                     class="border px-3 py-2 flex-1 rounded" required>
              <select name="salaryPeriod" class="border px-3 py-2 rounded md:w-40" required>
                <option value="day">per Day</option>
                <option value="week">per Week</option>
                <option value="month">per Month</option>
              </select>
            </div>
          </div>
        
          <!-- Time of day -->
          <div>
            <label class="block text-sm font-medium mb-1">Time of Day</label>
            <select name="timeOfDay" class="border px-3 py-2 w-full rounded" required>
              <option value="mchana">Mchana (Day)</option>
              <option value="usiku">Usiku (Night)</option>
            </select>
          </div>
          <!--location input with map preview-->
          <div class="relative">
            <input id="locationInput" type="text"
              class="border rounded w-full p-3"
              placeholder="Enter job location..." />
          </div>
        
          <!-- Containers for Map & Street View -->
          <div id="mapContainer" class="w-0 h-0 rounded border my-4"></div>
          <div id="streetContainer" class="w-0 h-0 rounded border my-4"></div>
          <!-- Post button -->
          <button type="submit" 
                  class="px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded w-full md:w-auto">
            Post Job
          </button>
        </form>        
      </section>

      <!-- APPLICATIONS -->
      <section id="view-applications" class="tab-view hidden max-w-5xl mx-auto p-4">
        <h2 class="text-2xl font-bold mb-6">Job Applications</h2>
      
        <!-- Sort Controls -->
        <div class="flex flex-col sm:flex-row sm:items-center sm:space-x-4 mb-4">
          <label class="text-sm mb-2 sm:mb-0 font-medium">Sort by:</label>
          <select id="sortSelect" class="border rounded p-2 w-full sm:w-auto">
            <option value="time">Time of Application</option>
            <option value="rating">Rating</option>
            <option value="jobs">Approved Jobs</option>
          </select>
        </div>
      
        <!-- Applications List -->
        <div id="applicationsList" class="space-y-4">
          <!-- Dynamic cards go here -->
        </div>
      </section>
      <!-- Notifications Section -->
      <section id="view-notifications" class="tab-view hidden max-w-5xl mx-auto p-4 hidden">
        <h2 class="text-2xl font-bold mb-6">Notifications</h2>

        <!-- List of notifications -->
        <div id="notificationsList" class="space-y-4"></div>

        <!-- Delete all -->
        <button id="deleteAllBtn"
        class="mt-6 bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
        Delete All Notifications
        </button>
      </section>
      <!-- PROFILE TAB -->
      <section id="view-profile" class="tab-view hidden p-6 max-w-4xl mx-auto">
        <!-- Profile header -->
        <div class="flex flex-col md:flex-row items-center md:items-start gap-6">
          <div class="relative">
            <img id="profilePicture"
                src="https://ui-avatars.com/api/?name=BlueJobs+User&background=0D8ABC&color=fff&size=150"
                alt="Profile Picture"
                class="w-40 h-40 rounded-full object-cover border">
            <label class="absolute bottom-0 right-0 bg-indigo-600 text-white px-2 py-1 rounded cursor-pointer text-sm">
              Change
              <input type="file" id="changePicture" accept="image/*" class="hidden">
            </label>
          </div>
          <div class="text-center md:text-left flex-1">
            <h2 id="profileName" class="text-2xl font-bold">John Doe</h2>
            <div class="flex items-center justify-center md:justify-start mt-1">
              <span id="profileRating" class="text-yellow-500 text-lg">⭐⭐⭐⭐☆</span>
              <span class="ml-2 text-sm text-gray-500">(4.2)</span>
            </div>
            <p id="profileStats" class="mt-2 text-gray-600">Jobs approved: 12</p>

            <!-- Buttons visible only to OTHER users -->
            <div id="profileActions" class="mt-4 flex gap-3">
              <button id="reportBtn"
                class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
                Report User
              </button>
              <button id="rateBtn"
                class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">
                Rate & Review
              </button>
            </div>
          </div>
        </div>
        <!-- Reviews Section -->
        <div class="mt-8">
          <h3 class="text-xl font-semibold mb-4">Reviews</h3>
          <div id="reviewsList" class="space-y-4">
            <!-- Example Review -->
            <div class="border p-3 rounded bg-gray-50">
              <p class="font-semibold">Jane M. <span class="text-yellow-500">⭐⭐⭐⭐⭐</span></p>
              <p class="text-gray-700 mt-1">Great to work with, very professional.</p>
            </div>
          </div>
        </div>
      </section>
      <!-- VERIFICATION TAB -->
      <section id="view-verification" class="tab-view hidden p-6 max-w-2xl mx-auto">
        <h2 class="text-2xl font-bold mb-6">Account Verification</h2>

        <form id="verificationForm" class="space-y-6">
          <!-- Front ID -->
          <div>
            <label class="block font-semibold mb-1">Front of ID</label>
            <input type="file" id="frontID" accept="image/*"
                  class="block w-full border p-2 rounded">
            <img id="frontPreview"
                class="hidden mt-2 w-48 h-32 object-cover border rounded"
                alt="Front ID preview">
          </div>

          <!-- Back ID -->
          <div>
            <label class="block font-semibold mb-1">Back of ID</label>
            <input type="file" id="backID" accept="image/*"
                  class="block w-full border p-2 rounded">
            <img id="backPreview"
                class="hidden mt-2 w-48 h-32 object-cover border rounded"
                alt="Back ID preview">
          </div>

          <!-- Live Selfie -->
          <div>
            <label class="block font-semibold mb-1">Live Selfie / Face Photo</label>
            <!-- `capture="user"` tells mobile browsers to use the front camera -->
            <input type="file" id="selfie" accept="image/*" capture="user"
                  class="block w-full border p-2 rounded">
            <img id="selfiePreview"
                class="hidden mt-2 w-48 h-48 object-cover border rounded-full"
                alt="Selfie preview">
          </div>

          <!-- Phone -->
          <div>
            <label class="block font-semibold mb-1">Phone Number</label>
            <input type="tel" id="phoneNumber"
                  placeholder="e.g. +254700000000"
                  class="block w-full border p-2 rounded">
          </div>

          <button type="submit"
            class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-semibold px-4 py-2 rounded">
            Submit for Verification
          </button>
        </form>

        <!-- Confirmation / Waiting message -->
        <div id="verificationStatus"
            class="hidden mt-6 p-4 text-center bg-green-50 border border-green-200 text-green-700 rounded">
          Your verification details have been submitted. Please wait for approval.
        </div>
      </section>
      <!-- ⭐ NEW MY JOBS TAB (Employer Only) -->
      <section id="view-myjobs" class="tab-view hidden p-6 max-w-5xl mx-auto">
        <h2 class="text-2xl font-bold mb-6">My Posted Jobs</h2>

        <!-- Search Bar -->
        <div class="mb-4">
          <input id="myJobsSearch" type="text"
            class="border p-2 w-full rounded"
            placeholder="Search my jobs by keyword...">
        </div>

        <div id="myJobsList" class="space-y-4"></div>
      </section>

      <!-- ⭐ NEW MY APPLICATIONS TAB (Employee Only) -->
      <section id="view-myapplications" class="tab-view hidden p-6 max-w-5xl mx-auto">
        <h2 class="text-2xl font-bold mb-6">My Applications</h2>

        <!-- Search Bar -->
        <div class="mb-4">
          <input id="myAppsSearch" type="text"
            class="border p-2 w-full rounded"
            placeholder="Search applied jobs by keyword...">
        </div>

        <div id="myApplicationsList" class="space-y-4"></div>
      </section>
      <!-- ================= JOB DETAILS TAB ================= -->
      <section id="view-job" class="tab-view hidden p-4 md:p-6">
        <div class="max-w-5xl mx-auto bg-white rounded-xl shadow p-6 space-y-6">

          <!-- Job Header -->
          <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
              <h1 class="text-2xl font-bold text-indigo-700">[Job Title Placeholder]</h1>
              <p class="text-sm text-gray-500">
                Posted on <span id="job-post-time">[Time Placeholder]</span>
              </p>
            </div>
            <button
              id="applyJobBtn"
              class="px-6 py-2 bg-indigo-600 text-white rounded hover:bg-indigo-700 transition">
              Apply
            </button>
          </div>

          <!-- Job Info -->
          <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
            <div>
              <p class="font-semibold text-gray-700">Employer</p>
              <p id="job-employer">[Employer Name]</p>
            </div>
            <div>
              <p class="font-semibold text-gray-700">Payment</p>
              <p id="job-payment">[Payment Amount]</p>
            </div>
            <div>
              <p class="font-semibold text-gray-700">Shift</p>
              <p id="job-shift">[Day/Night]</p>
            </div>
            <div>
              <p class="font-semibold text-gray-700">Location</p>
              <p id="job-location">[Location Address]</p>
            </div>
          </div>

          <!-- Map + Street View -->
          <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mt-6">
            <!-- Map with user + job and directions placeholder -->
            <div class="h-72 md:h-96 border rounded-lg overflow-hidden">
              <div id="jobMap" class="w-full h-full flex items-center justify-center text-gray-400">
                [Google Map Placeholder – marker & route will show here]
              </div>
            </div>

            <!-- Street View of nearest landmark -->
            <div class="h-72 md:h-96 border rounded-lg overflow-hidden">
              <div id="jobStreetView" class="w-full h-full flex items-center justify-center text-gray-400">
                [Street View Image Placeholder]
              </div>
            </div>
          </div>

        </div>
      </section>
      <!-- ===== POPUPS ===== -->
      <!-- Report Popup -->
      <div id="reportPopup" class="fixed inset-0 hidden bg-black/50 flex items-center justify-center z-50">
          <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full relative">
          <button class="absolute top-2 right-2 text-gray-600 hover:text-black"
                onclick="togglePopup('reportPopup', false)">✖</button>
          <h3 class="text-lg font-bold mb-3">Report User</h3>
          <textarea id="reportReason"
          class="w-full border p-2 rounded mb-4"
          placeholder="Describe the reason"></textarea>
          <div class="flex justify-end gap-3">
          <button onclick="togglePopup('reportPopup', false)"
            class="px-4 py-2 border rounded">Cancel</button>
          <button id="sendReport"
            class="px-4 py-2 bg-red-500 text-white rounded">Send Report</button>
          </div>
          </div>
      </div>
      <!-- Rate & Review Popup -->
      <div id="ratePopup" class="fixed inset-0 hidden bg-black/50 flex items-center justify-center z-50">
          <div class="bg-white p-6 rounded-lg shadow-lg max-w-md w-full relative">
          <button class="absolute top-2 right-2 text-gray-600 hover:text-black"
                onclick="togglePopup('ratePopup', false)">✖</button>
          <h3 class="text-lg font-bold mb-3">Rate & Review</h3>
          <div class="flex mb-3 text-2xl space-x-1" id="starContainer">
          <!-- Stars inserted dynamically -->
          </div>
          <textarea id="reviewText"
          class="w-full border p-2 rounded mb-4"
          placeholder="Write your review"></textarea>
          <div class="flex justify-end gap-3">
          <button onclick="togglePopup('ratePopup', false)"
            class="px-4 py-2 border rounded">Cancel</button>
          <button id="submitReview"
            class="px-4 py-2 bg-indigo-600 text-white rounded">Submit</button>
          </div>
          </div>
      </div>
    </div>
  </main>
</div>

<!-- JOB DETAIL MODAL -->
<div id="jobModal" class="fixed inset-0 hidden items-center justify-center bg-black/40 z-50">
  <div class="bg-white max-w-lg w-full p-6 rounded shadow relative">
    <button id="closeJobModal" class="absolute top-3 right-3 text-gray-500"><i class="fa-solid fa-xmark"></i></button>
    <div id="jobModalContent"></div>
  </div>
</div>
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCiBnV9V_2hyAaPeSZryL25viNirWrDSyw&libraries=maps,marker,places&callback=initMap" defer></script>
<script src="applications.js" defer></script>
<script src="notifications.js" defer></script>
<script src="profile.js" defer></script>
<script src="verification.js" defer></script>
<script>
let userRole = 'employee';   // change to 'employee' to test employee view
let active_tab = 'dashboard'; // default active tab
document.addEventListener('DOMContentLoaded', () => {
  const mobileMenuBtn = document.getElementById('mobileMenuBtn');
  const mobileMenu    = document.getElementById('mobileMenu');
  const mobileSignBtn = document.getElementById('mobileSignBtn');

  // check sign-in state (example using localStorage)
  const isSignedIn = localStorage.getItem('signedIn') === 'true';
  if (!isSignedIn) {
    mobileSignBtn.classList.remove('hidden');
  }

  mobileMenuBtn.addEventListener('click', () => {
    mobileMenu.classList.toggle('hidden');
  });
});
document.addEventListener("DOMContentLoaded",()=>{
  const $ = id=>document.getElementById(id);
  const navBtns=document.querySelectorAll('.nav-btn');
  const tabs=document.querySelectorAll('.tab-view');
  // ⭐ NEW: Role-based menu/tab logic
  const btnDashboard   = document.querySelector('[data-tab="dashboard"]');
  const btnPostJob     = document.querySelector('[data-tab="post-job"]');
  const btnApplications= document.querySelector('[data-tab="applications"]');
  const sidebarNav     = document.getElementById('sidebarNav');
  const mobileMenu     = document.getElementById('mobileMenu');
  // Dynamically add menu buttons for My Jobs / My Applications
  if (userRole === 'employer') {
    [...document.getElementsByClassName('btnMyJobs')].forEach((a)=>a.classList.remove('hidden'));
    [...document.getElementsByClassName('dashboard')].forEach((a)=>a.classList.add('hidden'));
    active_tab = 'myjobs';
    // optionally hide employee-only buttons
  } else if (userRole === 'employee') {
    [...document.getElementsByClassName('btnMyApplications')].forEach((a)=>a.classList.remove('hidden'));
    [...document.getElementsByClassName('applications')].forEach((a)=>a.classList.add('hidden'));
    [...document.getElementsByClassName('post-job')].forEach((a)=>a.classList.add('hidden'));
  };
  // ⭐ NEW: My Jobs renderer (for employer)
  function renderMyJobs(filter='') {
    if (userRole !== 'employer') return;
    const c = document.getElementById('myJobsList');
    const jobs = state.jobs.filter(j =>
      j.title.toLowerCase().includes(filter.toLowerCase())
    );
    c.innerHTML = jobs.length ? '' : '<div class="text-gray-500">No posted jobs.</div>';
    jobs.forEach(job=>{
      const el = document.createElement('div');
      el.className='bg-white p-4 rounded shadow flex justify-between items-start';
      el.innerHTML=`
        <div>
          <h3 class="font-semibold">${job.title}</h3>
          <p class="text-sm text-gray-500">Shift: ${job.tags.join(', ')}</p>
          <p class="text-xs text-gray-400">Posted: ${job.postedAt}</p>
          <p class="font-medium">${job.salary}</p>
        </div>
        <div class="flex gap-2">
          <button class="px-3 py-1 bg-indigo-500 text-white rounded edit-btn">Edit</button>
          <button class="px-3 py-1 bg-red-500 text-white rounded delete-btn">Delete</button>
        </div>`;
      // Demo delete
      el.querySelector('.delete-btn').onclick=()=>{
        state.jobs = state.jobs.filter(j=>j.id!==job.id);
        renderMyJobs(filter);
      };
      // Demo edit
      el.querySelector('.edit-btn').onclick=()=>{
        alert('Edit logic here (demo).');
      };
      c.appendChild(el);
    });
  }

  // ⭐ NEW: My Applications renderer (for employee)
  function renderMyApplications(filter='') {
    if (userRole !== 'employee') return;
    const c = document.getElementById('myApplicationsList');
    const apps = state.applications.filter(a =>
      a.title.toLowerCase().includes(filter.toLowerCase())
    );
    c.innerHTML = apps.length ? '' : '<div class="text-gray-500">No applications yet.</div>';
    apps.forEach(app=>{
      const el = document.createElement('div');
      el.className='bg-white p-4 rounded shadow flex justify-between items-start';
      el.innerHTML=`
        <div>
          <h3 class="font-semibold">${app.title}</h3>
          <p class="text-sm text-gray-500">${app.company}</p>
          <p class="text-xs text-gray-400">Applied: ${app.date}</p>
        </div>
        <button class="px-3 py-1 bg-red-500 text-white rounded cancel-btn">Cancel</button>`;
      el.querySelector('.cancel-btn').onclick=()=>{
        state.applications = state.applications.filter(a=>a!==app);
        renderMyApplications(filter);
      };
      c.appendChild(el);
    });
  }

  // Search handlers
  document.getElementById('myJobsSearch')?.addEventListener('input', e=>{
    renderMyJobs(e.target.value);
  });
  document.getElementById('myAppsSearch')?.addEventListener('input', e=>{
    renderMyApplications(e.target.value);
  });
  // Dummy state (in real app, fetch from server or localStorage)
  let state={
    signedIn:false,
    user:{name:'Guest',role:userRole,verified:false},
    jobs:[
      {id:1,title:'Event Helper',company:'BlueEvents',location:'Nairobi',salary:'KES 2,000/day',tags:['Day shift'],description:'Assist with event setup.',postedAt:'2025-08-12',lat:-1.2921,lng:36.8219},
      {id:2,title:'Kitchen Assistant',company:'MamaFood',location:'Mombasa',salary:'KES 1,500/day',tags:['Night shift'],description:'Help in kitchen tasks.',postedAt:'2025-09-01',lat:-4.0435,lng:39.6682}
    ],
    applications:[
      {title:'Cleaner',company:'CleanCo',date:'2025-09-10'},
      {title:'Cook',company:'Foodies',date:'2025-09-12'}
    ],
    notifications:[],
    subscription:false
  };
  function renderJobs(list = state.jobs) {
    const c = $('jobsList');
    c.innerHTML = '';

    if (list.length === 0) {
      c.innerHTML = '<div class="text-gray-500">No jobs found.</div>';
      return;
    }

    list.forEach(job => {
      const card = document.createElement('div');
      card.className =
        'job-card border bg-white rounded-xl p-4 shadow-sm flex justify-between items-start cursor-pointer';

      card.innerHTML = `
        <div>
          <h3 class="font-semibold">${job.title}</h3>
          <p class="text-sm text-gray-500">${job.company} • ${job.location}</p>
          <div class="mt-2 flex gap-2 text-xs">
            ${job.tags.map(t => `<span class="px-2 py-1 bg-gray-100 rounded">${t}</span>`).join('')}
          </div>
          <p class="text-xs text-gray-400 mt-2">Posted: ${job.postedAt}</p>
        </div>
        <div class="text-right font-medium">${job.salary || ''}</div>
      `;

      // ✅ When clicked, populate the job details tab and show it
      card.addEventListener('click', () => {
        $('view-job').querySelector('h1').textContent = job.title;
        $('job-post-time').textContent = job.postedAt;
        $('job-employer').textContent = job.company;
        $('job-payment').textContent = job.salary;
        $('job-shift').textContent = job.tags.join(', ');
        $('job-location').textContent = job.location;

        // Switch to the job details tab
        activateTab('job');
      });

      c.appendChild(card);
    });
  };
  renderJobs();
  if (userRole === 'employer') renderMyJobs();
  if (userRole === 'employee') renderMyApplications();
  //apply job button logic
  $('applyJobBtn').addEventListener('click', () => {
    if (!state.signedIn) {
      window.location.href = 'signin.html';
      return;
    }
    if (!state.user.verified) {
      activateTab('verification');
      alert('Please verify your account first.');
      return;
    }
    alert('Application submitted (demo).');
  });
  //switching tabs logic
  function activateTab(name){
    tabs.forEach(t=>t.classList.add('hidden'));
    navBtns.forEach(b=>b.classList.remove('tab-active'));
    $(`view-${name}`).classList.remove('hidden');
    document.querySelector(`[data-tab="${name}"]`).classList.add('tab-active');
  }
  navBtns.forEach(b=>b.addEventListener('click',()=>activateTab(b.dataset.tab)));
  activateTab(active_tab);


  $('searchBtn').addEventListener('click',()=>{
    const kw=$('searchKeyword').value.toLowerCase();
    const loc=$('searchLocation').value.toLowerCase();
    const filtered=state.jobs.filter(j=>
      (!kw||j.title.toLowerCase().includes(kw)) &&
      (!loc||j.location.toLowerCase().includes(loc))
    );
    renderJobs(filtered);
  });

  function renderApplications(){
    const c=$('applicationsList'); c.innerHTML='';
    if(state.applications.length===0){c.innerHTML='<div class="text-gray-500">No applications.</div>';return;}
    state.applications.forEach(a=>{
      const el=document.createElement('div');
      el.className='bg-white p-3 rounded shadow-sm flex justify-between';
      el.innerHTML=`<div><div class="font-semibold">${a.title}</div>
                    <div class="text-xs text-gray-500">${a.company} • ${a.date}</div></div>
                    <div class="text-sm">Pending</div>`;
      c.appendChild(el);
    });
  }
  function renderNotifications(){
    const c=$('notificationsList'); c.innerHTML='';
    if(state.notifications.length===0){c.innerHTML='<div class="text-gray-500">No notifications.</div>';return;}
    state.notifications.forEach(n=>{
      const el=document.createElement('div');
      el.className='bg-white p-3 rounded shadow-sm mb-2';
      el.innerHTML=`<div>${n.text}</div><div class="text-xs text-gray-400">${n.date}</div>`;
      c.appendChild(el);
    });
    $('notifBadge').textContent=state.notifications.length;
    $('notifBadge').classList.toggle('hidden',state.notifications.length===0);
  }

  $('postJobForm').addEventListener('submit',e=>{
    e.preventDefault();
    if(!state.signedIn){window.location.href='signin.html';return;}
    if(state.user.role!=='employer'){alert('Only employers can post jobs.');return;}
    if(!state.user.verified){activateTab('verification');alert('Verify your account first.');return;}
    const fd=new FormData(e.target);
    state.jobs.unshift({
      id:Date.now(),
      title:fd.get('title'),
      company:fd.get('company'),
      location:fd.get('location'),
      salary:fd.get('salary'),
      description:fd.get('description'),
      tags:fd.get('tags').split(',').map(s=>s.trim()),
      postedAt:new Date().toLocaleDateString(),
      lat:-1.29,lng:36.82
    });
    renderJobs();
    e.target.reset();
    activateTab('dashboard');
    alert('Job posted (demo).');
  });

  $('saveProfile').onclick=()=>{
    state.user.name=$('profileName').value||'User';
    state.user.role=$('profileRole').value;
    state.signedIn=true;
    alert('Profile saved (demo).');
  };

  $('verifyBtn').onclick=()=>{
    const ph=$('verifyPhone').value.trim();
    if(!ph){alert('Phone required');return;}
    $('verifyStatus').textContent='Submitted — verifying...';
    setTimeout(()=>{
      state.user.verified=true;
      state.notifications.push({text:'Account verified',date:new Date().toLocaleString()});
      $('verifyStatus').textContent='Verified ✅';
      renderNotifications();
    },1200);
  };

  $('subscribeBtn').onclick=()=>{
    if(!state.signedIn){window.location.href='signin.html';return;}
    state.subscription=true;
    $('subStatus').textContent='Active — thank you!';
    state.notifications.push({text:'Subscription started',date:new Date().toLocaleString()});
    renderNotifications();
  };

  $('signInBtn').onclick=()=>window.location.href='signin.html';
});
</script>
</body>
</html>